<!-- HTML header for doxygen 1.8.17-->
<!-- Copyright Â© 2023-2024 Arm Ltd and Contributors. -->
<!-- SPDX-License-Identifier: MIT -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Arm NN: src/backends/tosaCommon/operatorMappings/TosaRescaleOperatorUtils.hpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <img alt="ArmNN" src="Arm_NN_horizontal_blue.png" style="max-width: 15rem; margin-top: .5rem; margin-left 13px"/>
  <td id="projectalign" style="padding-left: 0.9em;">
   <div id="projectname">
   &#160;<span id="projectnumber">26.01</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_tosa_rescale_operator_utils_8hpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">TosaRescaleOperatorUtils.hpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="_exceptions_8hpp_source.html">armnn/Exceptions.hpp</a>&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for TosaRescaleOperatorUtils.hpp:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_tosa_rescale_operator_utils_8hpp__incl.svg" width="259" height="214"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_tosa_rescale_operator_utils_8hpp__dep__incl.svg" width="3440" height="171"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="_tosa_rescale_operator_utils_8hpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a11fb967d5cebd28296fc7c9ff01d0c9f" id="r_a11fb967d5cebd28296fc7c9ff01d0c9f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a11fb967d5cebd28296fc7c9ff01d0c9f">CreateRawRescaleTosaOperator</a> (const std::string &amp;inputName, const std::string &amp;outputName, const std::vector&lt; int32_t &gt; &amp;multipliers, const std::vector&lt; int32_t &gt; &amp;shifts, int32_t input_zp, int32_t output_zp, bool input_unsigned, bool output_unsigned, bool double_round, bool scale32, bool per_channel, TosaSerializationOperator **op)</td></tr>
<tr class="memdesc:a11fb967d5cebd28296fc7c9ff01d0c9f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a raw rescale TOSA operator.  <br /></td></tr>
<tr class="separator:a11fb967d5cebd28296fc7c9ff01d0c9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aecddbfafad9c28d90f9b383441c9f4c3" id="r_aecddbfafad9c28d90f9b383441c9f4c3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aecddbfafad9c28d90f9b383441c9f4c3">ComputeMultiplierAndShiftTosaScale32</a> (double scale, int32_t &amp;multiplier, int32_t &amp;shift)</td></tr>
<tr class="memdesc:aecddbfafad9c28d90f9b383441c9f4c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">The following is taken from mlir/lib/Dialect/Tosa/Utils/QuantUtils.cpp in the LLVM project From a scale value, generates multiplier and shift values where mantissa is in [-1.0,-0.5] or [0.5, 1.0] such that multiplier = mantissa*2^shift for 32-bit scaling.  <br /></td></tr>
<tr class="separator:aecddbfafad9c28d90f9b383441c9f4c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03ad1374824fb360589d9392518e05f1" id="r_a03ad1374824fb360589d9392518e05f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a03ad1374824fb360589d9392518e05f1">ComputeMultiplierAndShiftTosaScale16</a> (double scale, int32_t &amp;multiplier, int32_t &amp;shift)</td></tr>
<tr class="memdesc:a03ad1374824fb360589d9392518e05f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">The following is taken from mlir/lib/Dialect/Tosa/Utils/QuantUtils.cpp in the LLVM project From a scale value, generates multiplier and shift values where mantissa is in [-1.0,-0.5] or [0.5, 1.0] such that multiplier = mantissa*2^shift for 16-bit scaling.  <br /></td></tr>
<tr class="separator:a03ad1374824fb360589d9392518e05f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91aeec4e6963e182f2586733fec70157" id="r_a91aeec4e6963e182f2586733fec70157"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a91aeec4e6963e182f2586733fec70157">CreateRescaleTosaOperator</a> (const std::string &amp;inputName, const std::string &amp;outputName, double scale, int32_t input_zp, int32_t output_zp, bool input_unsigned, bool output_unsigned, bool double_round, bool scale32, TosaSerializationOperator **op)</td></tr>
<tr class="memdesc:a91aeec4e6963e182f2586733fec70157"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a Tosa rescale operator.  <br /></td></tr>
<tr class="separator:a91aeec4e6963e182f2586733fec70157"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb40dc6831c9f0cf499a9f25cb5cc377" id="r_afb40dc6831c9f0cf499a9f25cb5cc377"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afb40dc6831c9f0cf499a9f25cb5cc377">CreateRescaleTosaOperatorForWeights</a> (const std::string &amp;inputName, const std::string &amp;outputName, int32_t input_zp, int32_t output_zp, bool input_unsigned, bool output_unsigned, bool double_round, bool scale32, double input_scale, double output_scale, const std::vector&lt; float &gt; &amp;weight_scales, TosaSerializationOperator **op)</td></tr>
<tr class="memdesc:afb40dc6831c9f0cf499a9f25cb5cc377"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a TOSA rescale operator for weight tensors.  <br /></td></tr>
<tr class="separator:afb40dc6831c9f0cf499a9f25cb5cc377"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a03ad1374824fb360589d9392518e05f1" name="a03ad1374824fb360589d9392518e05f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03ad1374824fb360589d9392518e05f1">&#9670;&#160;</a></span>ComputeMultiplierAndShiftTosaScale16()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeMultiplierAndShiftTosaScale16 </td>
          <td>(</td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>scale</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t &amp;</td>          <td class="paramname"><span class="paramname"><em>multiplier</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t &amp;</td>          <td class="paramname"><span class="paramname"><em>shift</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The following is taken from mlir/lib/Dialect/Tosa/Utils/QuantUtils.cpp in the LLVM project From a scale value, generates multiplier and shift values where mantissa is in [-1.0,-0.5] or [0.5, 1.0] such that multiplier = mantissa*2^shift for 16-bit scaling. </p>

<p class="definition">Definition at line <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00137">137</a> of file <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html">TosaRescaleOperatorUtils.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  140</span>{</div>
<div class="line"><span class="lineno">  141</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> mantissa = std::frexp(scale, &amp;shift);</div>
<div class="line"><span class="lineno">  142</span>    <span class="keyword">auto</span> shiftedM = std::round(mantissa * (int64_t(1) &lt;&lt; 15));</div>
<div class="line"><span class="lineno">  143</span> </div>
<div class="line"><span class="lineno">  144</span>    <span class="comment">// Can&#39;t be greater than 1.0.</span></div>
<div class="line"><span class="lineno">  145</span>    <span class="keywordflow">if</span> (!(shiftedM &lt;= (int64_t(1) &lt;&lt; 15)))</div>
<div class="line"><span class="lineno">  146</span>    {</div>
<div class="line"><span class="lineno">  147</span>        <span class="keywordflow">throw</span> <a class="code hl_class" href="classarmnn_1_1_exception.html">armnn::Exception</a>(<span class="stringliteral">&quot;Shifted mantissa exceeds 16 signed bits&quot;</span>);</div>
<div class="line"><span class="lineno">  148</span>    }</div>
<div class="line"><span class="lineno">  149</span> </div>
<div class="line"><span class="lineno">  150</span>    <span class="keywordflow">if</span> (shiftedM == (int64_t(1) &lt;&lt; 15))</div>
<div class="line"><span class="lineno">  151</span>    {</div>
<div class="line"><span class="lineno">  152</span>        shiftedM /= 2;</div>
<div class="line"><span class="lineno">  153</span>        shift++;</div>
<div class="line"><span class="lineno">  154</span>    }</div>
<div class="line"><span class="lineno">  155</span> </div>
<div class="line"><span class="lineno">  156</span>    <span class="comment">// TOSA expects right shift to be positive and embed (1 &lt;&lt; 15) into right</span></div>
<div class="line"><span class="lineno">  157</span>    <span class="comment">// shift bits.</span></div>
<div class="line"><span class="lineno">  158</span>    shift = (-shift) + 15;</div>
<div class="line"><span class="lineno">  159</span> </div>
<div class="line"><span class="lineno">  160</span>    <span class="keywordflow">if</span> (!(shiftedM &lt;= std::numeric_limits&lt;int32_t&gt;::max()))</div>
<div class="line"><span class="lineno">  161</span>    {</div>
<div class="line"><span class="lineno">  162</span>        <span class="keywordflow">throw</span> <a class="code hl_class" href="classarmnn_1_1_exception.html">armnn::Exception</a>(<span class="stringliteral">&quot;Shifted mantissa exceeds 32-bit signed output type&quot;</span>);</div>
<div class="line"><span class="lineno">  163</span>    }</div>
<div class="line"><span class="lineno">  164</span> </div>
<div class="line"><span class="lineno">  165</span>    multiplier = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(shiftedM);</div>
<div class="line"><span class="lineno">  166</span> </div>
<div class="line"><span class="lineno">  167</span>    <span class="comment">// Shifting tops out at 62 bits. Right shift to make 62 bits the max.</span></div>
<div class="line"><span class="lineno">  168</span>    <span class="comment">// The limit of 62 on shift allows the shift to be decomposed as</span></div>
<div class="line"><span class="lineno">  169</span>    <span class="comment">// two right shifts of 31.</span></div>
<div class="line"><span class="lineno">  170</span>    <span class="keywordflow">if</span> (shift &gt; 62)</div>
<div class="line"><span class="lineno">  171</span>    {</div>
<div class="line"><span class="lineno">  172</span>        <span class="comment">// Shifting the multiplier by more than 31-bits is unnecessary.</span></div>
<div class="line"><span class="lineno">  173</span>        multiplier = multiplier &gt;&gt; std::min&lt;int32_t&gt;(31, shift - 62);</div>
<div class="line"><span class="lineno">  174</span>        shift = 62;</div>
<div class="line"><span class="lineno">  175</span>    }</div>
<div class="line"><span class="lineno">  176</span>}</div>
<div class="ttc" id="aclassarmnn_1_1_exception_html"><div class="ttname"><a href="classarmnn_1_1_exception.html">armnn::Exception</a></div><div class="ttdoc">Base class for all ArmNN exceptions so that users can filter to just those.</div><div class="ttdef"><b>Definition</b> <a href="_exceptions_8hpp_source.html#l00046">Exceptions.hpp:47</a></div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00197">CreateRescaleTosaOperator()</a>, and <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00258">CreateRescaleTosaOperatorForWeights()</a>.</p>

</div>
</div>
<a id="aecddbfafad9c28d90f9b383441c9f4c3" name="aecddbfafad9c28d90f9b383441c9f4c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aecddbfafad9c28d90f9b383441c9f4c3">&#9670;&#160;</a></span>ComputeMultiplierAndShiftTosaScale32()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeMultiplierAndShiftTosaScale32 </td>
          <td>(</td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>scale</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t &amp;</td>          <td class="paramname"><span class="paramname"><em>multiplier</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t &amp;</td>          <td class="paramname"><span class="paramname"><em>shift</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The following is taken from mlir/lib/Dialect/Tosa/Utils/QuantUtils.cpp in the LLVM project From a scale value, generates multiplier and shift values where mantissa is in [-1.0,-0.5] or [0.5, 1.0] such that multiplier = mantissa*2^shift for 32-bit scaling. </p>

<p class="definition">Definition at line <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00094">94</a> of file <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html">TosaRescaleOperatorUtils.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   97</span>{</div>
<div class="line"><span class="lineno">   98</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> mantissa = std::frexp(scale, &amp;shift);</div>
<div class="line"><span class="lineno">   99</span>    <span class="keyword">auto</span> shiftedM = std::round(mantissa * (int64_t(1) &lt;&lt; 31));</div>
<div class="line"><span class="lineno">  100</span> </div>
<div class="line"><span class="lineno">  101</span>    <span class="comment">// Can&#39;t be greater than 1.0.</span></div>
<div class="line"><span class="lineno">  102</span>    <span class="keywordflow">if</span> (!(shiftedM &lt;= (int64_t(1) &lt;&lt; 31)))</div>
<div class="line"><span class="lineno">  103</span>    {</div>
<div class="line"><span class="lineno">  104</span>        <span class="keywordflow">throw</span> <a class="code hl_class" href="classarmnn_1_1_exception.html">armnn::Exception</a>(<span class="stringliteral">&quot;Shifted mantissa exceeds 32 signed bits&quot;</span>);</div>
<div class="line"><span class="lineno">  105</span>    }</div>
<div class="line"><span class="lineno">  106</span> </div>
<div class="line"><span class="lineno">  107</span>    <span class="keywordflow">if</span> (shiftedM == (int64_t(1) &lt;&lt; 31))</div>
<div class="line"><span class="lineno">  108</span>    {</div>
<div class="line"><span class="lineno">  109</span>        shiftedM /= 2;</div>
<div class="line"><span class="lineno">  110</span>        shift++;</div>
<div class="line"><span class="lineno">  111</span>    }</div>
<div class="line"><span class="lineno">  112</span> </div>
<div class="line"><span class="lineno">  113</span>    <span class="comment">// TOSA expects right shift to be positive, and embed (1 &lt;&lt; 31) into right</span></div>
<div class="line"><span class="lineno">  114</span>    <span class="comment">// shift bits.</span></div>
<div class="line"><span class="lineno">  115</span>    shift = (-shift) + 31;</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>    <span class="keywordflow">if</span> (!(shiftedM &lt;= std::numeric_limits&lt;int32_t&gt;::max()))</div>
<div class="line"><span class="lineno">  118</span>    {</div>
<div class="line"><span class="lineno">  119</span>        <span class="keywordflow">throw</span> <a class="code hl_class" href="classarmnn_1_1_exception.html">armnn::Exception</a>(<span class="stringliteral">&quot;Shifted mantissa exceeds 32-bit signed output type&quot;</span>);</div>
<div class="line"><span class="lineno">  120</span>    }</div>
<div class="line"><span class="lineno">  121</span> </div>
<div class="line"><span class="lineno">  122</span>    multiplier = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(shiftedM);</div>
<div class="line"><span class="lineno">  123</span> </div>
<div class="line"><span class="lineno">  124</span>    <span class="comment">// Shifting tops out at 47 bits. Right shift to make 47 bits the max.</span></div>
<div class="line"><span class="lineno">  125</span>    int32_t maxShiftValue = 47;</div>
<div class="line"><span class="lineno">  126</span>    <span class="keywordflow">if</span> (shift &gt; maxShiftValue)</div>
<div class="line"><span class="lineno">  127</span>    {</div>
<div class="line"><span class="lineno">  128</span>        multiplier = multiplier &gt;&gt; std::min&lt;int32_t&gt;(31, shift - maxShiftValue);</div>
<div class="line"><span class="lineno">  129</span>        shift = maxShiftValue;</div>
<div class="line"><span class="lineno">  130</span>    }</div>
<div class="line"><span class="lineno">  131</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_reduce_operator_8cpp_source.html#l00017">ConvertReduceToTosaOperator()</a>, <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00197">CreateRescaleTosaOperator()</a>, and <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00258">CreateRescaleTosaOperatorForWeights()</a>.</p>

</div>
</div>
<a id="a11fb967d5cebd28296fc7c9ff01d0c9f" name="a11fb967d5cebd28296fc7c9ff01d0c9f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11fb967d5cebd28296fc7c9ff01d0c9f">&#9670;&#160;</a></span>CreateRawRescaleTosaOperator()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CreateRawRescaleTosaOperator </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;</td>          <td class="paramname"><span class="paramname"><em>inputName</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;</td>          <td class="paramname"><span class="paramname"><em>outputName</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32_t &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>multipliers</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32_t &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>shifts</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t</td>          <td class="paramname"><span class="paramname"><em>input_zp</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t</td>          <td class="paramname"><span class="paramname"><em>output_zp</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>input_unsigned</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>output_unsigned</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>double_round</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>scale32</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>per_channel</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TosaSerializationOperator **</td>          <td class="paramname"><span class="paramname"><em>op</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Creates a raw rescale TOSA operator. </p>
<p>This inline function creates a raw rescale operator for TOSA that adjusts the quantization parameters for an input tensor. It validates the multipliers and shifts vectors, ensuring they meet specific criteria for per-channel or global quantization. If any validation fails, an exception is thrown.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">inputName</td><td>: The name of the input tensor. </td></tr>
    <tr><td class="paramname">outputName</td><td>: The name of the output tensor. </td></tr>
    <tr><td class="paramname">multipliers</td><td>: A vector of multiplier values for scaling. </td></tr>
    <tr><td class="paramname">shifts</td><td>: A vector of shift values corresponding to the multipliers. </td></tr>
    <tr><td class="paramname">input_zp</td><td>: The zero point for the input tensor. </td></tr>
    <tr><td class="paramname">output_zp</td><td>: The zero point for the output tensor. </td></tr>
    <tr><td class="paramname">input_unsigned</td><td>: Indicates if the input tensor is unsigned. </td></tr>
    <tr><td class="paramname">output_unsigned</td><td>: Indicates if the output tensor is unsigned. </td></tr>
    <tr><td class="paramname">double_round</td><td>: If true, applies double rounding during quantization. </td></tr>
    <tr><td class="paramname">scale32</td><td>: If true, performs 32-bit scaling; otherwise, 16-bit scaling is used. </td></tr>
    <tr><td class="paramname">per_channel</td><td>: Determines whether per-channel quantization is applied. </td></tr>
    <tr><td class="paramname">op</td><td>: Pointer to store the created TosaSerializationOperator. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00032">32</a> of file <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html">TosaRescaleOperatorUtils.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   44</span>{</div>
<div class="line"><span class="lineno">   45</span>    <span class="keywordflow">if</span> (!op)</div>
<div class="line"><span class="lineno">   46</span>    {</div>
<div class="line"><span class="lineno">   47</span>        <span class="keywordflow">throw</span> <a class="code hl_class" href="classarmnn_1_1_exception.html">armnn::Exception</a>(<span class="stringliteral">&quot;CreateRawRescaleTosaOperator: nullptr op.&quot;</span>);</div>
<div class="line"><span class="lineno">   48</span>    }</div>
<div class="line"><span class="lineno">   49</span> </div>
<div class="line"><span class="lineno">   50</span>    <span class="keywordflow">if</span> (multipliers.empty())</div>
<div class="line"><span class="lineno">   51</span>    {</div>
<div class="line"><span class="lineno">   52</span>        <span class="keywordflow">throw</span> <a class="code hl_class" href="classarmnn_1_1_exception.html">armnn::Exception</a>(<span class="stringliteral">&quot;CreateRawRescaleTosaOperator: multipliers is empty.&quot;</span>);</div>
<div class="line"><span class="lineno">   53</span>    }</div>
<div class="line"><span class="lineno">   54</span> </div>
<div class="line"><span class="lineno">   55</span>    <span class="keywordflow">if</span> (multipliers.size() != shifts.size())</div>
<div class="line"><span class="lineno">   56</span>    {</div>
<div class="line"><span class="lineno">   57</span>        <span class="keywordflow">throw</span> <a class="code hl_class" href="classarmnn_1_1_exception.html">armnn::Exception</a>(<span class="stringliteral">&quot;CreateRawRescaleTosaOperator: multipliers and shift not same size.&quot;</span>);</div>
<div class="line"><span class="lineno">   58</span>    }</div>
<div class="line"><span class="lineno">   59</span> </div>
<div class="line"><span class="lineno">   60</span>    <span class="keywordflow">if</span> (multipliers.size() == 1 &amp;&amp; per_channel)</div>
<div class="line"><span class="lineno">   61</span>    {</div>
<div class="line"><span class="lineno">   62</span>        <span class="keywordflow">throw</span> <a class="code hl_class" href="classarmnn_1_1_exception.html">armnn::Exception</a>(<span class="stringliteral">&quot;CreateRawRescaleTosaOperator: \</span></div>
<div class="line"><span class="lineno">   63</span><span class="stringliteral">                                multipliers must be greater than 1 if per_channel is true.&quot;</span>);</div>
<div class="line"><span class="lineno">   64</span>    }</div>
<div class="line"><span class="lineno">   65</span> </div>
<div class="line"><span class="lineno">   66</span>    <span class="keywordflow">if</span> (multipliers.size() &gt; 1 &amp;&amp; !per_channel)</div>
<div class="line"><span class="lineno">   67</span>    {</div>
<div class="line"><span class="lineno">   68</span>        <span class="keywordflow">throw</span> <a class="code hl_class" href="classarmnn_1_1_exception.html">armnn::Exception</a>(<span class="stringliteral">&quot;CreateRawRescaleTosaOperator: \</span></div>
<div class="line"><span class="lineno">   69</span><span class="stringliteral">                                multipliers size must be 1 if per_channel is false.&quot;</span>);</div>
<div class="line"><span class="lineno">   70</span>    }</div>
<div class="line"><span class="lineno">   71</span> </div>
<div class="line"><span class="lineno">   72</span>    TosaRescaleAttribute attribute(input_zp,</div>
<div class="line"><span class="lineno">   73</span>                                   output_zp,</div>
<div class="line"><span class="lineno">   74</span>                                   multipliers,</div>
<div class="line"><span class="lineno">   75</span>                                   shifts,</div>
<div class="line"><span class="lineno">   76</span>                                   scale32,</div>
<div class="line"><span class="lineno">   77</span>                                   double_round,</div>
<div class="line"><span class="lineno">   78</span>                                   per_channel,</div>
<div class="line"><span class="lineno">   79</span>                                   input_unsigned,</div>
<div class="line"><span class="lineno">   80</span>                                   output_unsigned);</div>
<div class="line"><span class="lineno">   81</span> </div>
<div class="line"><span class="lineno">   82</span>    <span class="comment">// op</span></div>
<div class="line"><span class="lineno">   83</span>    *op = <span class="keyword">new</span> TosaSerializationOperator(Op_RESCALE, Attribute_RescaleAttribute, &amp;attribute, {inputName}, {outputName});</div>
<div class="line"><span class="lineno">   84</span>    <span class="keywordflow">if</span> (!(*op))</div>
<div class="line"><span class="lineno">   85</span>    {</div>
<div class="line"><span class="lineno">   86</span>        <span class="keywordflow">throw</span> <a class="code hl_class" href="classarmnn_1_1_exception.html">armnn::Exception</a>(<span class="stringliteral">&quot;CreateRescaleTosaOperator: failed to created operator&quot;</span>);</div>
<div class="line"><span class="lineno">   87</span>    }</div>
<div class="line"><span class="lineno">   88</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_reduce_operator_8cpp_source.html#l00017">ConvertReduceToTosaOperator()</a>, <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00197">CreateRescaleTosaOperator()</a>, and <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00258">CreateRescaleTosaOperatorForWeights()</a>.</p>

</div>
</div>
<a id="a91aeec4e6963e182f2586733fec70157" name="a91aeec4e6963e182f2586733fec70157"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91aeec4e6963e182f2586733fec70157">&#9670;&#160;</a></span>CreateRescaleTosaOperator()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CreateRescaleTosaOperator </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;</td>          <td class="paramname"><span class="paramname"><em>inputName</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;</td>          <td class="paramname"><span class="paramname"><em>outputName</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>scale</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t</td>          <td class="paramname"><span class="paramname"><em>input_zp</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t</td>          <td class="paramname"><span class="paramname"><em>output_zp</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>input_unsigned</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>output_unsigned</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>double_round</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>scale32</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TosaSerializationOperator **</td>          <td class="paramname"><span class="paramname"><em>op</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Creates a Tosa rescale operator. </p>
<p>This inline function computes the multiplier and shift values based on the given scale using either 32-bit or 16-bit scaling. It then creates a raw rescale operator that adjusts the quantization parameters for the input tensor.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">inputName</td><td>: The name of the input tensor. </td></tr>
    <tr><td class="paramname">outputName</td><td>: The name of the output tensor. </td></tr>
    <tr><td class="paramname">scale</td><td>: The scale factor used to compute the multiplier and shift. </td></tr>
    <tr><td class="paramname">input_zp</td><td>: The zero point for the input tensor. </td></tr>
    <tr><td class="paramname">output_zp</td><td>: The zero point for the output tensor. </td></tr>
    <tr><td class="paramname">input_unsigned</td><td>: Indicates if the input tensor is unsigned. </td></tr>
    <tr><td class="paramname">output_unsigned</td><td>Indicates if the output tensor is unsigned. </td></tr>
    <tr><td class="paramname">double_round</td><td>: If true, uses double rounding for quantization. </td></tr>
    <tr><td class="paramname">scale32</td><td>: If true, performs 32-bit scaling; otherwise, 16-bit scaling is used. </td></tr>
    <tr><td class="paramname">op</td><td>: Pointer to a variable that will store the created TosaSerializationOperator. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00197">197</a> of file <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html">TosaRescaleOperatorUtils.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  207</span>{</div>
<div class="line"><span class="lineno">  208</span>    int32_t multiplier;</div>
<div class="line"><span class="lineno">  209</span>    int32_t shift;</div>
<div class="line"><span class="lineno">  210</span> </div>
<div class="line"><span class="lineno">  211</span>    <span class="keywordflow">if</span> (scale32)</div>
<div class="line"><span class="lineno">  212</span>    {</div>
<div class="line"><span class="lineno">  213</span>        <a class="code hl_function" href="#aecddbfafad9c28d90f9b383441c9f4c3">ComputeMultiplierAndShiftTosaScale32</a>(scale, multiplier, shift);</div>
<div class="line"><span class="lineno">  214</span>    }</div>
<div class="line"><span class="lineno">  215</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  216</span>    {</div>
<div class="line"><span class="lineno">  217</span>        <a class="code hl_function" href="#a03ad1374824fb360589d9392518e05f1">ComputeMultiplierAndShiftTosaScale16</a>(scale, multiplier, shift);</div>
<div class="line"><span class="lineno">  218</span>    }</div>
<div class="line"><span class="lineno">  219</span> </div>
<div class="line"><span class="lineno">  220</span>    <span class="keyword">const</span> std::vector&lt;int32_t&gt; multipliers{multiplier};</div>
<div class="line"><span class="lineno">  221</span>    <span class="keyword">const</span> std::vector&lt;int32_t&gt; shifts{shift};</div>
<div class="line"><span class="lineno">  222</span> </div>
<div class="line"><span class="lineno">  223</span>    <a class="code hl_function" href="#a11fb967d5cebd28296fc7c9ff01d0c9f">CreateRawRescaleTosaOperator</a>(inputName,</div>
<div class="line"><span class="lineno">  224</span>                                 outputName,</div>
<div class="line"><span class="lineno">  225</span>                                 multipliers,</div>
<div class="line"><span class="lineno">  226</span>                                 shifts,</div>
<div class="line"><span class="lineno">  227</span>                                 input_zp,</div>
<div class="line"><span class="lineno">  228</span>                                 output_zp,</div>
<div class="line"><span class="lineno">  229</span>                                 input_unsigned,</div>
<div class="line"><span class="lineno">  230</span>                                 output_unsigned,</div>
<div class="line"><span class="lineno">  231</span>                                 double_round,</div>
<div class="line"><span class="lineno">  232</span>                                 scale32,</div>
<div class="line"><span class="lineno">  233</span>                                 <span class="keyword">false</span>,</div>
<div class="line"><span class="lineno">  234</span>                                 op);</div>
<div class="line"><span class="lineno">  235</span>}</div>
<div class="ttc" id="a_tosa_rescale_operator_utils_8hpp_html_a03ad1374824fb360589d9392518e05f1"><div class="ttname"><a href="#a03ad1374824fb360589d9392518e05f1">ComputeMultiplierAndShiftTosaScale16</a></div><div class="ttdeci">void ComputeMultiplierAndShiftTosaScale16(double scale, int32_t &amp;multiplier, int32_t &amp;shift)</div><div class="ttdoc">The following is taken from mlir/lib/Dialect/Tosa/Utils/QuantUtils.cpp in the LLVM project From a sca...</div><div class="ttdef"><b>Definition</b> <a href="_tosa_rescale_operator_utils_8hpp_source.html#l00137">TosaRescaleOperatorUtils.hpp:137</a></div></div>
<div class="ttc" id="a_tosa_rescale_operator_utils_8hpp_html_a11fb967d5cebd28296fc7c9ff01d0c9f"><div class="ttname"><a href="#a11fb967d5cebd28296fc7c9ff01d0c9f">CreateRawRescaleTosaOperator</a></div><div class="ttdeci">void CreateRawRescaleTosaOperator(const std::string &amp;inputName, const std::string &amp;outputName, const std::vector&lt; int32_t &gt; &amp;multipliers, const std::vector&lt; int32_t &gt; &amp;shifts, int32_t input_zp, int32_t output_zp, bool input_unsigned, bool output_unsigned, bool double_round, bool scale32, bool per_channel, TosaSerializationOperator **op)</div><div class="ttdoc">Creates a raw rescale TOSA operator.</div><div class="ttdef"><b>Definition</b> <a href="_tosa_rescale_operator_utils_8hpp_source.html#l00032">TosaRescaleOperatorUtils.hpp:32</a></div></div>
<div class="ttc" id="a_tosa_rescale_operator_utils_8hpp_html_aecddbfafad9c28d90f9b383441c9f4c3"><div class="ttname"><a href="#aecddbfafad9c28d90f9b383441c9f4c3">ComputeMultiplierAndShiftTosaScale32</a></div><div class="ttdeci">void ComputeMultiplierAndShiftTosaScale32(double scale, int32_t &amp;multiplier, int32_t &amp;shift)</div><div class="ttdoc">The following is taken from mlir/lib/Dialect/Tosa/Utils/QuantUtils.cpp in the LLVM project From a sca...</div><div class="ttdef"><b>Definition</b> <a href="_tosa_rescale_operator_utils_8hpp_source.html#l00094">TosaRescaleOperatorUtils.hpp:94</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00137">ComputeMultiplierAndShiftTosaScale16()</a>, <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00094">ComputeMultiplierAndShiftTosaScale32()</a>, and <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00032">CreateRawRescaleTosaOperator()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_elementwise_binary_operator_8cpp_source.html#l00009">ConvertElementwiseBinaryToTosaOperator()</a>, <a class="el" href="_leaky_relu_operator_8cpp_source.html#l00017">ConvertLeakyReluToTosaOperator()</a>, <a class="el" href="_p_relu_operator_8cpp_source.html#l00017">ConvertPReluToTosaOperator()</a>, <a class="el" href="_quantize_operator_8cpp_source.html#l00017">ConvertQuantizeToTosaOperator()</a>, <a class="el" href="_reduce_operator_8cpp_source.html#l00017">ConvertReduceToTosaOperator()</a>, <a class="el" href="_relu_operator_8cpp_source.html#l00017">ConvertReluToTosaOperator()</a>, <a class="el" href="_resize_operator_8cpp_source.html#l00016">ConvertResizeToTosaOperator()</a>, <a class="el" href="_softmax_operator_8cpp_source.html#l00017">ConvertSoftmaxToTosaOperator()</a>, and <a class="el" href="_elementwise_binary_operator_8cpp_source.html#l00368">ConvertSquaredDifferenceToTosaOperator()</a>.</p>

</div>
</div>
<a id="afb40dc6831c9f0cf499a9f25cb5cc377" name="afb40dc6831c9f0cf499a9f25cb5cc377"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb40dc6831c9f0cf499a9f25cb5cc377">&#9670;&#160;</a></span>CreateRescaleTosaOperatorForWeights()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CreateRescaleTosaOperatorForWeights </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;</td>          <td class="paramname"><span class="paramname"><em>inputName</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;</td>          <td class="paramname"><span class="paramname"><em>outputName</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t</td>          <td class="paramname"><span class="paramname"><em>input_zp</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t</td>          <td class="paramname"><span class="paramname"><em>output_zp</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>input_unsigned</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>output_unsigned</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>double_round</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>scale32</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>input_scale</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>output_scale</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; float &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>weight_scales</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TosaSerializationOperator **</td>          <td class="paramname"><span class="paramname"><em>op</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Creates a TOSA rescale operator for weight tensors. </p>
<p>This function computes multipliers and shift values for each weight scale by combining the input scale, weight scale, and output scale. It determines the quantization parameters using either 32-bit or 16-bit calculations based on the scale32 flag. The per_channel flag is set true if the provided weight scales are more than one. An exception is thrown if any computation fails.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">inputName</td><td>: The name of the input tensor. </td></tr>
    <tr><td class="paramname">outputName</td><td>: The name of the output tensor. </td></tr>
    <tr><td class="paramname">input_zp</td><td>: The zero point for the input tensor. </td></tr>
    <tr><td class="paramname">output_zp</td><td>: The zero point for the output tensor. </td></tr>
    <tr><td class="paramname">input_unsigned</td><td>: Indicates if the input tensor is unsigned. </td></tr>
    <tr><td class="paramname">output_unsigned</td><td>: Indicates if the output tensor is unsigned. </td></tr>
    <tr><td class="paramname">double_round</td><td>: If true, uses double rounding for quantization. </td></tr>
    <tr><td class="paramname">scale32</td><td>: If true, uses 32-bit scaling; otherwise, uses 16-bit scaling. </td></tr>
    <tr><td class="paramname">input_scale</td><td>: The scaling factor for the input tensor. </td></tr>
    <tr><td class="paramname">output_scale</td><td>: The scaling factor for the output tensor. </td></tr>
    <tr><td class="paramname">weight_scales</td><td>: Vector of weight scales for per-channel quantization. </td></tr>
    <tr><td class="paramname">op</td><td>: Pointer to store the created TosaSerializationOperator. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00258">258</a> of file <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html">TosaRescaleOperatorUtils.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  270</span>{</div>
<div class="line"><span class="lineno">  271</span>    std::vector&lt;int32_t&gt; op_tensor_multipliers;</div>
<div class="line"><span class="lineno">  272</span>    std::vector&lt;int32_t&gt; op_tensor_shifts;</div>
<div class="line"><span class="lineno">  273</span>    op_tensor_multipliers.reserve(weight_scales.size());</div>
<div class="line"><span class="lineno">  274</span>    op_tensor_shifts.reserve(weight_scales.size());</div>
<div class="line"><span class="lineno">  275</span> </div>
<div class="line"><span class="lineno">  276</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">float</span>&amp; weight_scale : weight_scales)</div>
<div class="line"><span class="lineno">  277</span>    {</div>
<div class="line"><span class="lineno">  278</span>        <span class="keywordtype">double</span> op_tensor_scale = (input_scale * weight_scale) / output_scale;</div>
<div class="line"><span class="lineno">  279</span>        int32_t multiplier;</div>
<div class="line"><span class="lineno">  280</span>        int32_t shift;</div>
<div class="line"><span class="lineno">  281</span> </div>
<div class="line"><span class="lineno">  282</span>        <span class="keywordflow">if</span> (scale32)</div>
<div class="line"><span class="lineno">  283</span>        {</div>
<div class="line"><span class="lineno">  284</span>            <a class="code hl_function" href="#aecddbfafad9c28d90f9b383441c9f4c3">ComputeMultiplierAndShiftTosaScale32</a>(op_tensor_scale, multiplier, shift);</div>
<div class="line"><span class="lineno">  285</span>        }</div>
<div class="line"><span class="lineno">  286</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  287</span>        {</div>
<div class="line"><span class="lineno">  288</span>            <a class="code hl_function" href="#a03ad1374824fb360589d9392518e05f1">ComputeMultiplierAndShiftTosaScale16</a>(op_tensor_scale, multiplier, shift);</div>
<div class="line"><span class="lineno">  289</span>        }</div>
<div class="line"><span class="lineno">  290</span> </div>
<div class="line"><span class="lineno">  291</span>        op_tensor_multipliers.push_back(multiplier);</div>
<div class="line"><span class="lineno">  292</span>        op_tensor_shifts.push_back(shift);</div>
<div class="line"><span class="lineno">  293</span>    }</div>
<div class="line"><span class="lineno">  294</span> </div>
<div class="line"><span class="lineno">  295</span>    <span class="keywordtype">bool</span> per_channel = weight_scales.size() == 1 ? false : <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  296</span>    <a class="code hl_function" href="#a11fb967d5cebd28296fc7c9ff01d0c9f">CreateRawRescaleTosaOperator</a>(inputName,</div>
<div class="line"><span class="lineno">  297</span>                                 outputName,</div>
<div class="line"><span class="lineno">  298</span>                                 op_tensor_multipliers,</div>
<div class="line"><span class="lineno">  299</span>                                 op_tensor_shifts,</div>
<div class="line"><span class="lineno">  300</span>                                 input_zp,</div>
<div class="line"><span class="lineno">  301</span>                                 output_zp,</div>
<div class="line"><span class="lineno">  302</span>                                 input_unsigned,</div>
<div class="line"><span class="lineno">  303</span>                                 output_unsigned,</div>
<div class="line"><span class="lineno">  304</span>                                 double_round,</div>
<div class="line"><span class="lineno">  305</span>                                 scale32,</div>
<div class="line"><span class="lineno">  306</span>                                 per_channel,</div>
<div class="line"><span class="lineno">  307</span>                                 op);</div>
<div class="line"><span class="lineno">  308</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00137">ComputeMultiplierAndShiftTosaScale16()</a>, <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00094">ComputeMultiplierAndShiftTosaScale32()</a>, and <a class="el" href="_tosa_rescale_operator_utils_8hpp_source.html#l00032">CreateRawRescaleTosaOperator()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_batch_mat_mul_operator_8cpp_source.html#l00014">ConvertBatchMatMulToTosaOperator()</a>, <a class="el" href="_conv2d_operator_8cpp_source.html#l00010">ConvertConv2dToTosaOperator()</a>, <a class="el" href="_conv3d_operator_8cpp_source.html#l00016">ConvertConv3dToTosaOperator()</a>, <a class="el" href="_depthwise_conv2d_operator_8cpp_source.html#l00010">ConvertDepthwiseConv2dToTosaOperator()</a>, and <a class="el" href="_fully_connected_operator_8cpp_source.html#l00016">ConvertFullyConnectedToTosaOperator()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_0f3cdec46afbc61a1ded8e1687c9c9a0.html">backends</a></li><li class="navelem"><a class="el" href="dir_3eeadfb79f8e6e284b92aba47a7684a1.html">tosaCommon</a></li><li class="navelem"><a class="el" href="dir_44a5c203710327e1068d2575c20cb7c6.html">operatorMappings</a></li><li class="navelem"><a class="el" href="_tosa_rescale_operator_utils_8hpp.html">TosaRescaleOperatorUtils.hpp</a></li>
    <li class="footer">Generated on Fri Jan 23 2026 10:38:49 for Arm NN by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
